---
title: "Data Visualisation"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  message = FALSE,
  warning = FALSE)
```


```{r}
library(tidyverse)
library(learnr)
library(ggplot2)
library(gridExtra)
```

## A simple example of data visualisation 
An interesting chocolate dataset with diverse ingredients in choclates. Firstly, library `readr()` and then use `read_csv()` function to import the chocolate dataset.
```{r}
library(readr)
chocolates <- read_csv("data/chocolates.csv")
```

```{r echo = FALSE}
chocolates <- chocolates %>%
  mutate(Contain_Chol = ifelse(Chol_mg > 0, TRUE, FALSE)) %>% 
  mutate(Type = factor(Type))
```
* Different chocolates in rows are our observations and ingredients are variables.
* Our variables include fiber, fat, calories countries and etc...
```{r}
head(chocolates) 
```

* Use `glimpse()` function to have a look at our data type relative to different variables
* Data type: character, factor, double and logical 
```{r}
glimpse(chocolates) 
```

### Make a plot by using chocolate data 
* Use `ggplot()` to visualise the data  
* Change the title and the name of x axis by using `ggtitle()` and `xlab()`
```{r}
ggplot(data = chocolates, aes(x = Sugars_g, y = Calories, color = Type)) + 
  geom_point() + 
  ggtitle("The relationship between calories and sugars relative to chocolate types") +
  xlab("Sugars")
```

## Scatter plot
* Using function geom_point() in the `ggplot2` package 
* Using mtcars as our data (`mtcars` is a default dataset in `ggplot2`)

### What is mtcars?
* Motor Trend Car Road Tests
* Use `help()` function to find more information 
* Important variables: 
    + mpg -- Miles/(US) gallon
    + cyl -- Number of cylinders
    + wt -- Weight (1000 lbs)
    + vs -- Engine (0 = V-shaped, 1 = straight)
    + am -- Transmission (0 = automatic, 1 = manual)
    + hp -- Gross horsepower
```{r}
glimpse(mtcars)
```

### Simple point plot 
The graph indicates that the cars with lower weight tend to use petrol more efficiently.
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg)) + 
  geom_point() 
```

### Color with discrete variable
* Use `factor()` to make `cyl` as a factor  
* `color` is in the `aes()` function 
* The function `labs()` can be used to easily update the legend title for a given aesthetic (fill, color, size, shape, linetype, â€¦)
* We can change the text color and position of the legend as well

The graph demonstrates the relationship beween the weight and the miles of cars relative to the number of cylinders the cars have. Heavy cars tend to have more cylinders and light cars tend to have high speed. 
```{r}
p1 <- ggplot(data = mtcars, aes(x = wt, y = mpg, color = factor(cyl))) + 
  geom_point() +
  labs(color = "cyl")

p2 <- ggplot(data = mtcars, aes(x = wt, y = mpg, color = factor(cyl))) + 
  geom_point() +
  labs(color = "cyl") +
  theme(legend.position = "top",
        legend.title = element_text(color = "blue", size = 10, face = "bold"),
        legend.text = element_text(color = "blue", size = 10, face = "bold"))

grid.arrange(p1, p2, nrow = 1)
```

### Color with continous variable
#### Question: What kind of cars tend to have high horsepower?
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg, color = hp)) + 
  geom_point() +
  labs(color = "hp") 
```

### Blue color 
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg)) + 
  geom_point(color = "blue")
```

### Points with different shapes 
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg, shape = factor(cyl))) + 
  geom_point() + 
  labs(shape = "cyl")
```

### Points with different sizes 
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg, size = factor(cyl))) + 
  geom_point() +
  labs(size = "cyl")
```

### Points with transparency
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg, alpha = factor(cyl))) + 
  geom_point() + 
  labs(alpha = "cyl")
```

### Combined with color and shape 
#### What you can get from this graph?
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg, shape = factor(am), color = hp)) + 
  geom_point() +
  labs(x = "Weight (1000 lbs)", y = "Miles per gallon", color = "Gross horsepower") +
  scale_shape_discrete(name = "Transmission", labels = c("automatic", "manual"))
```

* Manual cars have high efficiency of using petrol 
* One manual car has the highest horsepower -- think about sports cars
 
### Scatterplot Matrices 
* All variables are supposed to be numerical 
* Rotate the text of x axis in order to be seen clearly 
```{r}
library(GGally)
mtcars %>% 
  mutate(am = factor(am)) %>% 
  ggscatmat(data=.,color = "am", columns=c(1,3,4,5,6,7)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

## Facetting 
### Using `facet_wrap()`
By using facetting, we can clearly idendify the features of cars with different number of cylinders. 
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg)) + 
  geom_point() + 
  facet_wrap(~cyl)
```

### Using `facet_grid()`
Add facets categorized by multiple varibles
```{r}
ggplot(data = mtcars) +
  geom_point(mapping = aes(x = wt, y = mpg)) + 
  facet_grid(cyl ~ am)
```

## Line graph 
### Simple line graph
* Using `mpg` as our data frame and use `help()` function to get more information 
* Fuel economy data from 1999 and 2008 for 38 popular models of car
* Using function `geom_line()`
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_line()
```

### Fit a linear regression 
* Using span to control the "wiggliness" of the default loess smoother.
* The span is the fraction of points used to fit each local regression.
* Small numbers make a wigglier curve, larger numbers make a smoother curve.
```{r}
p3 <- ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point() +
  geom_smooth()

p4 <- ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point() +
  geom_smooth(span = 0.3)

grid.arrange(p3, p4, nrow = 1)
```

### Set `se = FALSE` to get rid of standard error
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point() +
  geom_smooth(span = 0.3, se = FALSE)
```

### Adding a vertical line 
```{r}
ggplot(data = mtcars, aes(x = wt, y = mpg)) + 
  geom_point() +
  geom_vline(xintercept = 3)

ggplot(data = mtcars, aes(x = wt, y = mpg)) + 
  geom_point() +
  geom_vline(xintercept = 3, linetype = "dotted", 
             color = "blue", size = 1.5)
```

## Boxplot, histogram and bar chart 
### Boxplot 
* Change the background by using `theme_bw()` function 
* Add color correponding to `drv` 
```{r}
ggplot(data = mpg, aes(x = drv, y = hwy, fill = drv)) + 
  geom_boxplot() +
  theme_bw()
```

### Histogram 
* Using `binwidth()` to adjust the width of each bin  
* we only need y axis in the `aes()` 
```{r}
ggplot(data = mpg, aes(hwy)) + 
  geom_histogram(binwidth = 0.6)
```

### Bar chart
```{r}
ggplot(data = mpg, aes(hwy)) + 
  geom_bar()
```

### Count of `drv` in bar chart 
```{r}
ggplot(data = mpg, aes(hwy, fill = drv)) + 
  geom_bar() +
  scale_fill_brewer(palette="Dark2")
```

### 100% barcharts
When cars are moving using front wheels on highway, they tend to drive more miles per gallon instead of using all 4 wheels or only rear wheels. 
```{r}
ggplot(data = mpg, aes(hwy, fill = drv)) + 
  geom_bar(position="fill") +
  scale_fill_brewer(palette="Dark2")
```

### Side-by-side barcharts 
When cars are moving on the highway, they are more likely to use 4 wheels or just front wheels. 
```{r}
ggplot(data = mpg, aes(x = hwy, fill = drv)) + 
  geom_bar(position="dodge") +
  scale_fill_brewer(palette="Dark2")
```

### What can you get from this complicated graph? 
- Different types of cars use different wheels to move as they may have different functions 
- Small cars tend to use petrol more efficiently on highway than large cars 
```{r}
ggplot(data = mpg, aes(x = hwy, fill = drv)) + 
  geom_bar(position="dodge") +
  facet_wrap(~class) +
  scale_fill_brewer(palette="Dark2")
```

